generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              String           @id @default(cuid())
  email           String?          @unique
  phone           String?          @unique
  password        String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  status          AccountStatus    @default(active)
  role            UserRole
  customerProfile CustomerProfile?
  sellerProfile   SellerProfile?
}

model CustomerProfile {
  id        String      @id @default(cuid())
  userId    String      @unique
  name      String?
  dob       DateTime?
  gender    UserGender?
  createdAt DateTime    @default(now())
  updatedAt DateTime    @updatedAt

  Cart      Cart?
  addresses Address[]
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  orders    Order[]
}

model SellerProfile {
  id              String           @id @default(cuid())
  userId          String           @unique
  storeName       String
  gstNumber       String?
  isVerified      Boolean          @default(false)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  products        Product[]
  productVariants ProductVariant[]
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Address {
  id         String          @id @default(cuid(2))
  isPrimary  Boolean         @default(false)
  houseNo    String?
  street     String?
  city       String?
  state      String?
  country    String?
  pincode    String?
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
  customerId String
  customer   CustomerProfile @relation(fields: [customerId], references: [id])
}

model Category {
  id        String         @id @default(cuid())
  name      String         @unique
  status    CategoryStatus @default(inactive)
  createdAt DateTime       @default(now())
  updatedAt DateTime       @updatedAt
  products  Product[]      @relation("CategoryProducts")
}

model Product {
  id              String           @id @default(cuid(2))
  name            String
  description     String
  categoryId      String
  status          ProductStatus    @default(active)
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  sellerProfileId String
  brand           String?
  isDeleted       Boolean          @default(false)
  category        Category         @relation("CategoryProducts", fields: [categoryId], references: [id])
  sellerProfile   SellerProfile    @relation(fields: [sellerProfileId], references: [id])
  variants        ProductVariant[]
  cartItems       CartItem[]

  @@index([categoryId])
  @@index([status])
}

model ProductVariant {
  id              String         @id @default(cuid(2))
  productId       String
  stock           Int            @default(0)
  isDeleted       Boolean        @default(false)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime       @updatedAt
  discountPercent Float?         @default(0)
  price           Float
  attributes      Json?
  isActive        Boolean        @default(true)
  sellerProfileId String
  status          VariantStatus  @default(active)
  variantName     String
  cartItems       CartItem[]
  product         Product        @relation(fields: [productId], references: [id], onDelete: Cascade)
  sellerProfile   SellerProfile  @relation(fields: [sellerProfileId], references: [id])
  images          VariantImage[]

  @@index([productId])
  @@index([sellerProfileId])
  @@index([status])
  @@index([isActive])
}

model VariantImage {
  id        String         @id @default(cuid(2))
  variantId String
  publicId  String
  url       String
  position  Int
  createdAt DateTime       @default(now())
  variant   ProductVariant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([variantId, position])
  @@index([variantId])
}

model Cart {
  id         String          @id @default(cuid(2))
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
  customerId String          @unique
  Customer   CustomerProfile @relation(fields: [customerId], references: [id])
  items      CartItem[]
}

model CartItem {
  id             String         @id @default(cuid(2))
  cartId         String
  variantId      String
  quantity       Int
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  productId      String
  cart           Cart           @relation(fields: [cartId], references: [id])
  Product        Product?       @relation(fields: [productId], references: [id])
  ProductVariant ProductVariant @relation(fields: [variantId], references: [id])

  @@unique([cartId, variantId])
  @@index([cartId])
  @@index([variantId])
}

model Order {
  id                  String           @id @default(uuid())
  orderNumber         String           @unique
  subtotal            Float
  shippingCharge      Float            @default(0)
  tax                 Float            @default(0)
  discount            Float            @default(0)
  couponDiscount      Float            @default(0)
  offerDiscount       Float            @default(0)
  total               Float
  appliedCouponCode   String?
  appliedOfferIds     String[]         @default([])
  items               Json
  metadata            Json?
  paymentMethod       String?
  paymentStatus       PaymentStatus    @default(pending)
  orderStatus         OrderStatus      @default(pending)
  shippingAddressJson Json?
  cancelReason        String?
  refundAmount        Float?
  isDeleted           Boolean          @default(false)
  placedAt            DateTime         @default(now())
  updatedAt           DateTime         @updatedAt
  deliveredAt         DateTime?
  cancelledAt         DateTime?
  customerId          String?
  customerProfile     CustomerProfile? @relation(fields: [customerId], references: [id])
}

model LandingPage {
  id             String   @id @default(uuid())
  heroTitle      String?
  heroSubtitle   String?
  topCategoryIds String[] @default([])
  topProductIds  String[] @default([])
  sections       Json     @default("[]")
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model Coupon {
  id              String        @id @default(cuid(2))
  code            String        @unique
  type            CouponType
  discount        Float
  minAmount       Float         @default(0)
  maxDiscount     Float?
  startDate       DateTime
  endDate         DateTime
  status          CouponStatus  @default(active)
  usageLimit      Int?
  usedCount       Int           @default(0)
  maxUsagePerUser Int           @default(1)
  applicableTo    Applicability @default(all)
  isStackable     Boolean       @default(false)
  description     String?
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  couponUsages    CouponUsage[]
}

model Offer {
  id                String      @id @default(uuid())
  name              String
  type              OfferType
  discount          Float
  minPurchaseAmount Float       @default(0)
  maxDiscount       Float?
  priority          Int         @default(0)
  startDate         DateTime
  endDate           DateTime
  status            OfferStatus @default(active)
  isStackable       Boolean     @default(false)
  categories        String[]
  products          String[]
  description       String?
  createdAt         DateTime    @default(now())
  updatedAt         DateTime    @updatedAt
}

model CouponUsage {
  id              String   @id @default(cuid())
  couponId        String
  userId          String
  orderId         String?
  discountApplied Float
  usedAt          DateTime @default(now())
  coupon          Coupon   @relation(fields: [couponId], references: [id], onDelete: Cascade)

  @@index([couponId])
  @@index([userId])
  @@index([orderId])
}

enum UserRole {
  ADMIN
  SELLER
  CUSTOMER
}

enum AccountStatus {
  active
  suspended
  disabled
}

enum UserGender {
  male
  female
  other
}

enum CategoryStatus {
  active
  inactive
}

enum ProductStatus {
  active
  inactive
  discontinued
}

enum VariantStatus {
  active
  inactive
  out_of_stock
}

enum OrderStatus {
  pending
  processing
  shipping
  delivered
  canceled
  return_requested
  return_approved
  return_rejected
  returned
}

enum PaymentStatus {
  pending
  paid
  failed
  refunded
}

enum CouponType {
  Percentage
  Flat
}

enum CouponStatus {
  active
  inactive
  expired
}

enum OfferType {
  Percentage
  Flat
}

enum OfferStatus {
  active
  inactive
  expired
}

enum Applicability {
  all
  specific_products
  specific_categories
}
